FUNCTION(BUILD_ENV_MODULE FILE)
  FILE(WRITE  ${FILE}  "#%Module\n")
  FILE(APPEND ${FILE} "set project ${PROJECT_NAME}\n")
  FILE(APPEND ${FILE} "set root ${PREFIX}\n")
  FILE(APPEND ${FILE} "set plat ${FC_PLAT}\n")
  FILE(APPEND ${FILE} "set version \"${VERSION} (${FC_PLAT})\"\n")
  FILE(APPEND ${FILE} "set compiler ${CMAKE_Fortran_COMPILER}\n")
  FILE(READ   ${SF_ENV}/module CONTENTS)
  FILE(APPEND ${FILE} "${CONTENTS}")
ENDFUNCTION()



FUNCTION(BUILD_CONFIGVARS_USER FILE)
  FILE(READ   ${SF_BIN}/scifor_config_user.sh CONTENTS)
  FILE(WRITE  ${FILE} "${CONTENTS}")
  FILE(APPEND ${FILE} "add_library_to_system ${CMAKE_INSTALL_PREFIX}\n")
ENDFUNCTION()

FUNCTION(BUILD_CONFIGVARS_GLOBAL FILE)
  FILE(READ   ${SF_BIN}/scifor_config_global.sh CONTENTS)
  FILE(WRITE  ${FILE} "${CONTENTS}")
  FILE(APPEND ${FILE} "add_library_to_system ${CMAKE_INSTALL_PREFIX}\n")
ENDFUNCTION()


FUNCTION(BUILD_PKCONFIG FILE)
  FILE(WRITE ${FILE} "prefix=${CMAKE_INSTALL_PREFIX}\n")
  FILE(READ   ${SF_ETC}/${PROJECT_NAME}.pc CONTENTS)
  FILE(APPEND ${FILE} "${CONTENTS}")
  SET(LIBDIR "\\$\\{libdir\\}")
  STRING(REPLACE "\\" ""  LIBDIR ${LIBDIR})
  IF(MKL_FOUND)
    IF(MKL_SCALAPACK_FOUND)
      SET(SF_LIBDIR "-L${LIBDIR} -lscifor ${MKL_LIBRARIES}")
    ELSE()
      IF(SCALAPACK_FOUND)
	SET(SF_LIBDIR "-L${LIBDIR} -lscifor ${MKL_LIBRARIES} ${SCALAPACK_LIBRARIES}")
      ELSE()
	SET(SF_LIBDIR "-L${LIBDIR} -lscifor ${MKL_LIBRARIES}")
      ENDIF()
    ENDIF()
  ELSEIF(BLAS_FOUND OR LAPACK_FOUND)
    IF(SCALAPACK_FOUND)
      IF(APPLE)
	SET(SF_LIBDIR "-L${LIBDIR} -lscifor ${SCALAPACK_LIBRARIES} -llapack -lblas")
      ELSE()
	SET(SF_LIBDIR "-L${LIBDIR} -lscifor ${SCALAPACK_LIBRARIES} ${LAPACK_LIBRARIES} ${BLAS_LIBRARIES}")
      ENDIF(APPLE)
    ELSE()
      IF(APPLE)
	SET(SF_LIBDIR "-L${LIBDIR} -lscifor -llapack -lblas")
      ELSE()
	SET(SF_LIBDIR "-L${LIBDIR} -lscifor ${LAPACK_LIBRARIES} ${BLAS_LIBRARIES}")
      ENDIF(APPLE)
    ENDIF(SCALAPACK_FOUND)
  ELSE()
    SET(SF_LIBDIR "-L${LIBDIR} -lscifor\n")
  ENDIF()
  MESSAGE(STATUS "${Yellow}SF compilation lines:${ColourReset} ${SF_LIBDIR}")
  FILE(APPEND ${FILE} "Libs: ${SF_LIBDIR}\n")
  FILE(APPEND ${FILE} "Version:${VERSION}\n")
ENDFUNCTION()
